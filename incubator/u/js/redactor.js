var _0xf6db = ["(6(){11 49=24;11 14={50:6(8,10){5 10.58(8)&92},57:6(8,10){7(8.58!=12){5 8.58(10)&16}46{5 8.57(10)}},55:6(8,18,10,20){7(8===10){5 18<=20}7(14.29(8)&&14.29(10)){5 14.50(8,10)}7(14.29(8)&&!14.29(10)){5!14.55(10,20,8,18)}7(!14.57(8,10)){5 14.50(8,10)}7(8.47.85<=18){5 40}7(8.47[18]===10){5 0<=20}5 14.50(8.47[18],10)},29:6(61){5(61!=12?61.93==3:40)},81:6(41){11 62=0;88(41=41.59){62++}5 62}};11 4=49.4=(6(){6 4(2){24.2=2}4.34.31=6(){5 4.31(24.2)};4.34.37=6(){5 4.37(24.2)};4.34.38=6(){5 4.38(24.2)};4.34.45=6(){5 4.45(24.2)};4.34.44=6(){5 4.44(24.2)};4.34.52=6(25,26,23,22){5 4.52(24.2,25,26,23,22)};4.34.51=6(){5 4.51(24.2)};5 4})();7(49.35){4.67=43;4.31=6(2){11 9;5(9=2.35())&&(9.63!=12)&&(9.36!=12)};4.37=6(2){11 9;7(!((9=2.35())&&(9.36!=12))){5 12}5[9.36,9.97]};4.38=6(2){11 9;7(!((9=2.35())&&(9.63!=12))){5 12}5[9.63,9.91]};4.45=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[8,18]}5[10,20]};4.44=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[10,20]}5[8,18]};4.52=6(2,25,26,23,22){11 9=2.35();7(!9){5}7(23==12){23=25}7(22==12){22=26}7(9.60&&9.79){9.60(25,26);9.79(23,22)}46{54=2.15.56();54.106(25,26);54.107(23,22);71{9.73()}80(41){}9.98(54)}};4.51=6(2){71{11 9=2.35();7(!9){5}9.73()}80(41){}}}46 7(49.15.39){11 69=6(42,32,30){11 19,13,21,33,64;13=42.90('89');19=32.103();19.60(30);64=19.77();88(43){64.86(13,13.59);19.82(13);7(!(19.87((30?'66':'83'),32)>0&&(13.59!=12))){99}}7(19.87((30?'66':'83'),32)===-1&&13.84){19.74((30?'100':'78'),32);21=13.84;33=19.101.85}46{21=13.48;33=14.81(13)}13.48.72(13);5[21,33]};11 68=6(42,32,30,21,33){11 36,65,19,13,53;53=0;36=14.29(21)?21:21.47[33];65=14.29(21)?21.48:21;7(14.29(21)){53=33}13=42.90('89');65.86(13,36||12);19=42.76.75();19.82(13);13.48.72(13);32.74((30?'66':'78'),19);5 32[30?'105':'104']('102',53)};4.67=43;4.31=6(2){11 17;2.70();7(!2.15.39){5 40}17=2.15.39.56();5 17&&17.77().15===2.15};4.45=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,43)};4.44=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,40)};4.37=6(2){5 4.45(2)};4.38=6(2){5 4.44(2)};4.52=6(2,25,26,23,22){7(23==12){23=25}7(22==12){22=26}11 17=2.15.76.75();68(2.15,17,40,23,22);68(2.15,17,43,25,26);5 17.96()};4.51=6(2){5 2.15.39.95()}}46{4.67=40}}).94(24);", "|", "split", "||win||Selection|return|function|if|n1|sel|n2|var|null|cursorNode|Dom|document||range|o1|cursor|o2|node|foco|focn|this|orgn|orgo|_ref|_ref2|isText|bStart|hasSelection|textRange|offset|prototype|getSelection|anchorNode|getOrigin|getFocus|selection|false|e|doc|true|getEnd|getStart|else|childNodes|parentNode|root|isPreceding|clearSelection|setSelection|textOffset|r|isCursorPreceding|createRange|contains|compareDocumentPosition|previousSibling|collapse|d|k|focusNode|parent|anchorParent|StartToStart|supported|moveBoundary|getBoundary|focus|try|removeChild|removeAllRanges|setEndPoint|createTextRange|body|parentElement|EndToEnd|extend|catch|getChildIndex|moveToElementText|StartToEnd|nextSibling|length|insertBefore|compareEndPoints|while|a|createElement|focusOffset|0x02|nodeType|call|empty|select|anchorOffset|addRange|break|EndToStart|text|character|duplicate|moveEnd|moveStart|setStart|setEnd", "replace", "", "\\w+", "\\b", "g"];
eval(function (e, t, n, r, i, s) {
    i = function (e) {
        return e
    };
    if (!_0xf6db[5][_0xf6db[4]](/^/, String)) {
        while (n--)s[n] = r[n] || n;
        r = [function (e) {
            return s[e]
        }], i = function () {
            return _0xf6db[6]
        }, n = 1
    }
    while (n--)r[n] && (e = e[_0xf6db[4]](new RegExp(_0xf6db[7] + i(n) + _0xf6db[7], _0xf6db[8]), r[n]));
    return e
}(_0xf6db[0], 10, 108, _0xf6db[3][_0xf6db[2]](_0xf6db[1]), 0, {}));
if (typeof RELANG == "undefined")var RELANG = {};
var RLANG = {html: "HTML", video: "Insert Video...", image: "Insert Image...", table: "Table", link: "Link", link_insert: "Insert Link ...", unlink: "Unlink", formatting: "Formatting", paragraph: "Paragraph", quote: "Quote", code: "Code", header1: "Header 1", header2: "Header 2", header3: "Header 3", header4: "Header 4", bold: "Bold", italic: "Italic", fontcolor: "Font Color", backcolor: "Back Color", unorderedlist: "Unordered List", orderedlist: "Ordered List", outdent: "Outdent", indent: "Indent", cancel: "Cancel", insert: "Insert", save: "Save", _delete: "Delete", insert_table: "Insert Table...", insert_row_above: "Add Row Above", insert_row_below: "Add Row Below", insert_column_left: "Add Column Left", insert_column_right: "Add Column Right", delete_column: "Delete Column", delete_row: "Delete Row", delete_table: "Delete Table", rows: "Rows", columns: "Columns", add_head: "Add Head", delete_head: "Delete Head", title: "Title", image_position: "Position", none: "None", left: "Left", right: "Right", image_web_link: "Image Web Link", text: "Text", mailto: "Email", web: "URL", video_html_code: "Video Embed Code", file: "Insert File...", upload: "Upload", download: "Download", choose: "Choose", or_choose: "Or choose", drop_file_here: "Drop file here", align_left: "Align Left", align_center: "Align Center", align_right: "Align Right", align_justify: "Justify", horizontalrule: "Insert Horizontal Rule", deleted: "Deleted", anchor: "Anchor"};
jQuery.fn.redactor = function (e) {
    return this.each(function () {
        var t = $(this), n = t.data("redactor");
        n || t.data("redactor", n = new Redactor(this, e))
    })
};
var Redactor = function (e, t) {
    this.$el = $(e), typeof t != "undefined" && typeof t.lang != "undefined" && t.lang !== "en" && typeof RELANG[t.lang] != "undefined" && (RLANG = RELANG[t.lang]), this.opts = $.extend({lang: "en", direction: "ltr", callback: !1, keyupCallback: !1, keydownCallback: !1, execCommandCallback: !1, focus: !1, autoresize: !0, fixed: !1, mobile: !0, air: !1, wym: !1, convertLinks: !0, autosave: !1, interval: 60, imageGetJson: !1, imageUpload: !1, imageUploadCallback: !1, fileUpload: !1, fileUploadCallback: !1, uploadCrossDomain: !1, uploadFields: !1, observeImages: !0, overlay: !0, allowedTags: ["code", "span", "div", "label", "a", "br", "p", "b", "i", "del", "strike", "img", "video", "audio", "iframe", "object", "embed", "param", "blockquote", "mark", "cite", "small", "ul", "ol", "li", "hr", "dl", "dt", "dd", "sup", "sub", "big", "pre", "code", "figure", "figcaption", "strong", "em", "table", "tr", "td", "th", "tbody", "thead", "tfoot", "h1", "h2", "h3", "h4", "h5", "h6"], buttonsCustom: {}, buttonsAdd: [], buttons: ["html", "|", "formatting", "|", "bold", "italic", "deleted", "|", "unorderedlist", "orderedlist", "outdent", "indent", "|", "image", "video", "file", "table", "link", "|", "fontcolor", "backcolor", "|", "alignleft", "aligncenter", "alignright", "justify", "|", "horizontalrule"], airButtons: ["formatting", "|", "bold", "italic", "deleted", "|", "unorderedlist", "orderedlist", "outdent", "indent", "|", "fontcolor", "backcolor"], colors: ["#ffffff", "#000000", "#eeece1", "#1f497d", "#4f81bd", "#c0504d", "#9bbb59", "#8064a2", "#4bacc6", "#f79646", "#ffff00", "#f2f2f2", "#7f7f7f", "#ddd9c3", "#c6d9f0", "#dbe5f1", "#f2dcdb", "#ebf1dd", "#e5e0ec", "#dbeef3", "#fdeada", "#fff2ca", "#d8d8d8", "#595959", "#c4bd97", "#8db3e2", "#b8cce4", "#e5b9b7", "#d7e3bc", "#ccc1d9", "#b7dde8", "#fbd5b5", "#ffe694", "#bfbfbf", "#3f3f3f", "#938953", "#548dd4", "#95b3d7", "#d99694", "#c3d69b", "#b2a2c7", "#b7dde8", "#fac08f", "#f2c314", "#a5a5a5", "#262626", "#494429", "#17365d", "#366092", "#953734", "#76923c", "#5f497a", "#92cddc", "#e36c09", "#c09100", "#7f7f7f", "#0c0c0c", "#1d1b10", "#0f243e", "#244061", "#632423", "#4f6128", "#3f3151", "#31859b", "#974806", "#7f6000"], allEmptyHtml: "<p><br /></p>", mozillaEmptyHtml: "<p>&nbsp;</p>", buffer: !1, visual: !0, modal_file: String() + '<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data">' + "<label>Name (optional)</label>" + '<input type="text" id="redactor_filename" class="redactor_input" />' + '<div style="margin-top: 7px;">' + '<input type="file" id="redactor_file" name="file" />' + "</div>" + "</form>", modal_image_edit: String() + "<label>" + RLANG.title + "</label>" + '<input id="redactor_file_alt" class="redactor_input" />' + "<label>" + RLANG.link + "</label>" + '<input id="redactor_file_link" class="redactor_input" />' + "<label>" + RLANG.image_position + "</label>" + '<select id="redactor_form_image_align">' + '<option value="none">' + RLANG.none + "</option>" + '<option value="left">' + RLANG.left + "</option>" + '<option value="right">' + RLANG.right + "</option>" + "</select>" + '<div id="redactor_modal_footer">' + '<a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">' + RLANG._delete + "</a>" + '<span class="redactor_btns_box">' + '<input type="button" name="save" id="redactorSaveBtn" value="' + RLANG.save + '" />' + '<a href="javascript:void(null);" id="redactor_btn_modal_close">' + RLANG.cancel + "</a>" + "</span>" + "</div>", modal_image: String() + '<div id="redactor_tabs">' + '<a href="javascript:void(null);" class="redactor_tabs_act">' + RLANG.upload + "</a>" + '<a href="javascript:void(null);">' + RLANG.choose + "</a>" + '<a href="javascript:void(null);">' + RLANG.link + "</a>" + "</div>" + '<form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data">' + '<div id="redactor_tab1" class="redactor_tab">' + '<input type="file" id="redactor_file" name="file" />' + "</div>" + '<div id="redactor_tab2" class="redactor_tab" style="display: none;">' + '<div id="redactor_image_box"></div>' + "</div>" + "</form>" + '<div id="redactor_tab3" class="redactor_tab" style="display: none;">' + "<label>" + RLANG.image_web_link + "</label>" + '<input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  />' + "</div>" + '<div id="redactor_modal_footer">' + '<span class="redactor_btns_box">' + '<input type="button" name="upload" id="redactor_upload_btn" value="' + RLANG.insert + '" />' + '<a href="javascript:void(null);" id="redactor_btn_modal_close">' + RLANG.cancel + "</a>" + "</span>" + "</div>", modal_link: String() + '<form id="redactorInsertLinkForm" method="post" action="">' + '<div id="redactor_tabs">' + '<a href="javascript:void(null);" class="redactor_tabs_act">URL</a>' + '<a href="javascript:void(null);">Email</a>' + '<a href="javascript:void(null);">' + RLANG.anchor + "</a>" + "</div>" + '<input type="hidden" id="redactor_tab_selected" value="1" />' + '<div class="redactor_tab" id="redactor_tab1">' + '<label>URL</label><input id="redactor_link_url" class="redactor_input"  />' + "<label>" + RLANG.text + '</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" />' + "</div>" + '<div class="redactor_tab" id="redactor_tab2" style="display: none;">' + '<label>Email</label><input id="redactor_link_mailto" class="redactor_input" />' + "<label>" + RLANG.text + '</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" />' + "</div>" + '<div class="redactor_tab" id="redactor_tab3" style="display: none;">' + "<label>" + RLANG.anchor + '</label><input class="redactor_input" id="redactor_link_anchor"  />' + "<label>" + RLANG.text + '</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" />' + "</div>" + "</form>" + '<div id="redactor_modal_footer">' + '<span class="redactor_btns_box">' + '<input type="button" id="redactor_insert_link_btn" value="' + RLANG.insert + '" />' + '<a href="javascript:void(null);" id="redactor_btn_modal_close">' + RLANG.cancel + "</a>" + "</span>" + "</div>", modal_table: String() + "<label>" + RLANG.rows + "</label>" + '<input size="5" value="2" id="redactor_table_rows" />' + "<label>" + RLANG.columns + "</label>" + '<input size="5" value="3" id="redactor_table_columns" />' + '<div id="redactor_modal_footer">' + '<span class="redactor_btns_box">' + '<input type="button" name="upload" id="redactor_insert_table_btn" value="' + RLANG.insert + '" />' + '<a href="javascript:void(null);" id="redactor_btn_modal_close">' + RLANG.cancel + "</a>" + "</span>" + "</div>", modal_video: String() + '<form id="redactorInsertVideoForm">' + "<label>" + RLANG.video_html_code + "</label>" + '<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>' + "</form>" + '<div id="redactor_modal_footer">' + '<span class="redactor_btns_box">' + '<input type="button" id="redactor_insert_video_btn" value="' + RLANG.insert + '" />' + '<a href="javascript:void(null);" id="redactor_btn_modal_close">' + RLANG.cancel + "</a>" + "</span>" + "</div>", toolbar: {html: {title: RLANG.html, func: "toggle"}, formatting: {title: RLANG.formatting, func: "show", dropdown: {p: {title: RLANG.paragraph, exec: "formatblock"}, blockquote: {title: RLANG.quote, exec: "formatblock", className: "redactor_format_blockquote"}, pre: {title: RLANG.code, exec: "formatblock", className: "redactor_format_pre"}, h1: {title: RLANG.header1, exec: "formatblock", className: "redactor_format_h1"}, h2: {title: RLANG.header2, exec: "formatblock", className: "redactor_format_h2"}, h3: {title: RLANG.header3, exec: "formatblock", className: "redactor_format_h3"}, h4: {title: RLANG.header4, exec: "formatblock", className: "redactor_format_h4"}}}, bold: {title: RLANG.bold, exec: "bold"}, italic: {title: RLANG.italic, exec: "italic"}, deleted: {title: RLANG.deleted, exec: "strikethrough"}, unorderedlist: {title: "&bull; " + RLANG.unorderedlist, exec: "insertunorderedlist"}, orderedlist: {title: "1. " + RLANG.orderedlist, exec: "insertorderedlist"}, outdent: {title: "< " + RLANG.outdent, exec: "outdent"}, indent: {title: "> " + RLANG.indent, exec: "indent"}, image: {title: RLANG.image, func: "showImage"}, video: {title: RLANG.video, func: "showVideo"}, file: {title: RLANG.file, func: "showFile"}, table: {title: RLANG.table, func: "show", dropdown: {insert_table: {title: RLANG.insert_table, func: "showTable"}, separator_drop1: {name: "separator"}, insert_row_above: {title: RLANG.insert_row_above, func: "insertRowAbove"}, insert_row_below: {title: RLANG.insert_row_below, func: "insertRowBelow"}, insert_column_left: {title: RLANG.insert_column_left, func: "insertColumnLeft"}, insert_column_right: {title: RLANG.insert_column_right, func: "insertColumnRight"}, separator_drop2: {name: "separator"}, add_head: {title: RLANG.add_head, func: "addHead"}, delete_head: {title: RLANG.delete_head, func: "deleteHead"}, separator_drop3: {name: "separator"}, delete_column: {title: RLANG.delete_column, func: "deleteColumn"}, delete_row: {title: RLANG.delete_row, func: "deleteRow"}, delete_table: {title: RLANG.delete_table, func: "deleteTable"}}}, link: {title: RLANG.link, func: "show", dropdown: {link: {title: RLANG.link_insert, func: "showLink"}, unlink: {title: RLANG.unlink, exec: "unlink"}}}, fontcolor: {title: RLANG.fontcolor, func: "show"}, backcolor: {title: RLANG.backcolor, func: "show"}, alignleft: {exec: "JustifyLeft", title: RLANG.align_left}, aligncenter: {exec: "JustifyCenter", title: RLANG.align_center}, alignright: {exec: "JustifyRight", title: RLANG.align_right}, justify: {exec: "justifyfull", title: RLANG.align_justify}, horizontalrule: {exec: "inserthorizontalrule", title: RLANG.horizontalrule}}}, t, this.$el.data()), this.dropdowns = [], this.init()
};
Redactor.prototype = {init: function () {
    this.height = this.$el.css("height"), this.width = this.$el.css("width");
    if (this.opts.mobile === !1 && this.isMobile())return this.build(!0), !1;
    this.opts.air ? this.opts.buttons = this.opts.airButtons : this.opts.toolbar !== !1 && ($.extend(this.opts.toolbar, this.opts.buttonsCustom), $.each(this.opts.buttonsAdd, $.proxy(function (e, t) {
        this.opts.buttons.push(t)
    }, this))), this.build(), this.enableAir(), this.buildToolbar(), this.isMobile(!0) === !1 && this.$editor.bind("paste", $.proxy(function (e) {
        this.setBuffer();
        var t = this.extractContent();
        setTimeout($.proxy(function () {
            var e = this.extractContent();
            this.$editor.append(t), this.restoreSelection();
            var n = this.getFragmentHtml(e);
            this.pasteCleanUp(n)
        }, this), 1)
    }, this)), this.keyup(), this.keydown(), this.opts.autosave !== !1 && this.autoSave(), this.observeImages(), this.observeTables(), $.browser.mozilla && (document.execCommand("enableObjectResizing", !1, !1), document.execCommand("enableInlineTableEditing", !1, !1)), this.opts.focus && this.$editor.focus(), this.opts.fixed && (this.observeScroll(), $(document).scroll($.proxy(this.observeScroll, this))), typeof this.opts.callback == "function" && this.opts.callback(this)
}, shortcuts: function (e, t) {
    e.preventDefault(), this.execCommand(t, !1)
}, keyup: function () {
    this.$editor.keyup($.proxy(function (e) {
        var t = e.keyCode || e.which;
        typeof this.opts.keyupCallback == "function" && this.opts.keyupCallback(this, e);
        if (t === 8 || t === 46)return this.observeImages(), this.formatEmpty(e);
        if (t === 13 && !e.shiftKey && !e.ctrlKey && !e.metaKey)return this.formatNewLine(e);
        this.syncCode()
    }, this))
}, keydown: function () {
    this.$editor.keydown($.proxy(function (e) {
        var t = e.keyCode || e.which, n = this.getParentNode(), r = !1, i = e.ctrlKey || e.metaKey;
        n && $(n).get(0).tagName === "PRE" && (r = !0), typeof this.opts.keydownCallback == "function" && this.opts.keydownCallback(this, e), i && (t === 90 ? this.opts.buffer !== !1 ? (e.preventDefault(), this.getBuffer()) : this.shortcuts(e, "undo") : t === 90 && e.shiftKey ? this.shortcuts(e, "redo") : t === 77 ? this.shortcuts(e, "removeFormat") : t === 66 ? this.shortcuts(e, "bold") : t === 73 ? this.shortcuts(e, "italic") : t === 74 ? this.shortcuts(e, "insertunorderedlist") : t === 75 ? this.shortcuts(e, "insertorderedlist") : t === 76 ? this.shortcuts(e, "superscript") : t === 72 && this.shortcuts(e, "subscript")), !i && t !== 90 && (this.opts.buffer = !1), r === !0 && t === 13 && (e.preventDefault(), this.insertNodeAtCaret(document.createTextNode("\r\n"))), !e.shiftKey && t === 9 ? r === !1 ? this.shortcuts(e, "indent") : (e.preventDefault(), this.insertNodeAtCaret(document.createTextNode("	"))) : e.shiftKey && t === 9 && this.shortcuts(e, "outdent");
        if ($.browser.webkit && navigator.userAgent.indexOf("Chrome") === -1)return this.safariShiftKeyEnter(e, t)
    }, this))
}, build: function (e) {
    if (e !== !0) {
        this.$box = $('<div class="redactor_box"></div>'), this.opts.air && (this.air = $('<div class="redactor_air" style="display: none;"></div>')), this.textareamode = !0, this.$el.get(0).tagName === "TEXTAREA" ? this.$editor = $("<div></div>") : (this.textareamode = !1, this.$editor = this.$el, this.$el = $('<textarea name="' + this.$editor.attr("id") + '"></textarea>').css("height", this.height)), this.$editor.addClass("redactor_editor").attr("contenteditable", !0).attr("dir", this.opts.direction), this.opts.wym === !0 && this.$editor.addClass("redactor_editor_wym"), this.opts.autoresize === !1 && this.$editor.css("height", this.height), this.$el.hide();
        var t = "";
        this.textareamode ? (t = this.$el.val(), this.$box.insertAfter(this.$el).append(this.$editor).append(this.$el)) : (t = this.$editor.html(), this.$box.insertAfter(this.$editor).append(this.$el).append(this.$editor)), t = this.paragraphy(t), this.$editor.html(t), this.textareamode === !1 && this.syncCode()
    } else if (this.$el.get(0).tagName !== "TEXTAREA") {
        var t = this.$el.val(), n = $('<textarea name="' + this.$editor.attr("id") + '"></textarea>').css("height", this.height).val(t);
        this.$el.hide(), this.$el.after(n)
    }
}, enableAir: function () {
    if (this.opts.air === !1)return!1;
    this.air.hide(), this.$editor.bind("textselect", $.proxy(function (e) {
        this.showAir(e)
    }, this)), this.$editor.bind("textunselect", $.proxy(function () {
        this.air.hide()
    }, this))
}, showAir: function (e) {
    $(".redactor_air").hide();
    var t = this.air.innerWidth(), n = e.clientX;
    $(document).width() < n + t && (n -= t), this.air.css({left: n + "px", top: e.clientY + $(document).scrollTop() + 14 + "px"}).show()
}, syncCode: function () {
    this.$el.val(this.$editor.html())
}, setCode: function (e) {
    this.$editor.html(e).focus(), this.syncCode()
}, getCode: function () {
    var e = this.$editor ? this.$editor.html() : this.$el.val();
    return e
}, insertHtml: function (e) {
    this.execCommand("inserthtml", e), this.observeImages()
}, destroy: function () {
    var e = this.getCode();
    this.textareamode ? (this.$box.after(this.$el), this.$box.remove(), this.$el.val(e).show()) : (this.$box.after(this.$editor), this.$box.remove(), this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable", !1).html(e).show());
    for (var t = 0; t < this.dropdowns.length; t++)this.dropdowns[t].remove(), delete this.dropdowns[t]
}, observeImages: function () {
    if (this.opts.observeImages === !1)return!1;
    this.$editor.find("img").each($.proxy(function (e, t) {
        $.browser.msie && $(t).attr("unselectable", "on"), this.resizeImage(t)
    }, this))
}, observeTables: function () {
    this.$editor.find("table").click($.proxy(this.tableObserver, this))
}, observeScroll: function () {
    var e = $(document).scrollTop(), t = this.$box.offset().top;
    e > t ? (this.fixed = !0, this.$toolbar.css({position: "fixed", width: "100%", zIndex: 100})) : (this.fixed = !1, this.$toolbar.css({position: "relative", width: "auto", zIndex: 1}))
}, setBuffer: function () {
    this.saveSelection(), this.opts.buffer = this.$editor.html()
}, getBuffer: function () {
    if (this.opts.buffer === !1)return!1;
    this.$editor.html(this.opts.buffer), $.browser.msie || this.restoreSelection(), this.opts.buffer = !1
}, execCommand: function (e, t) {
    try {
        var n;
        e === "inserthtml" && $.browser.msie ? document.selection.createRange().pasteHTML(t) : e === "formatblock" && $.browser.msie ? document.execCommand(e, !1, "<" + t + ">") : e === "unlink" ? (n = this.getParentNode(), $(n).get(0).tagName === "A" ? $(n).replaceWith($(n).text()) : document.execCommand(e, !1, t)) : e === "formatblock" && t === "blockquote" ? (n = this.getParentNode(), $(n).get(0).tagName === "BLOCKQUOTE" ? document.execCommand(e, !1, "p") : document.execCommand(e, !1, t)) : e === "formatblock" && t === "pre" ? (n = this.getParentNode(), $(n).get(0).tagName === "PRE" ? $(n).replaceWith("<p>" + $(n).text() + "</p>") : document.execCommand(e, !1, t)) : document.execCommand(e, !1, t), this.syncCode(), this.$editor.focus(), typeof this.opts.execCommandCallback == "function" && this.opts.execCommandCallback(this, e), this.opts.air && this.air.hide()
    } catch (r) {
    }
}, formatNewLine: function (e) {
    if (!$.browser.webkit)return this.syncCode(), !0;
    var t = this.getParentNode();
    if (t.nodeName !== "DIV" || t.className !== "redactor_editor")return this.syncCode(), !0;
    e.preventDefault();
    var n = $(this.getCurrentNode());
    if (n.get(0).tagName === "DIV" && (n.html() === "" || n.html() === "<br>")) {
        var r = $("<p>").append(n.clone().get(0).childNodes);
        return n.replaceWith(r), r.html("<br />"), this.setFocusNode(r.get(0)), this.syncCode(), !1
    }
    this.syncCode(), this.opts.convertLinks && this.$editor.linkify()
}, safariShiftKeyEnter: function (e, t) {
    if (e.shiftKey && t === 13) {
        e.preventDefault();
        var n = $("<span><br /></span>");
        return this.insertNodeAtCaret(n.get(0)), this.syncCode(), !1
    }
    return!0
}, formatEmpty: function (e) {
    var t = $.trim(this.$editor.html());
    $.browser.mozilla && (t = t.replace(/<br>/i, ""));
    if (t === "") {
        e.preventDefault();
        var n = this.opts.allEmptyHtml;
        $.browser.mozilla && (n = this.opts.mozillaEmptyHtml);
        var r = $(n).get(0);
        return this.$editor.html(r), this.setFocusNode(r), this.syncCode(), !1
    }
    this.syncCode()
}, paragraphy: function (e) {
    e = $.trim(e);
    if (e === "")return $.browser.mozilla ? this.opts.mozillaEmptyHtml : this.opts.allEmptyHtml;
    e = e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi, "<p>$2</p>");
    var t = function (e, t, n) {
        return e.replace(new RegExp(t, "g"), n)
    }, n = function (n, r) {
        return t(e, n, r)
    }, r = "(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";
    return e += "\n", n("<br />\\s*<br />", "\n\n"), n("(<" + r + "[^>]*>)", "\n$1"), n("(</" + r + ">)", "$1\n\n"), n("\r\n|\r", "\n"), n("\n\n+", "\n\n"), n("\n?((.|\n)+?)$", "<p>$1</p>\n"), n("<p>\\s*?</p>", ""), n("<p>(<div[^>]*>\\s*)", "$1<p>"), n("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)", "<p>$1</p>$2"), n("<p>\\s*(</?" + r + "[^>]*>)\\s*</p>", "$1"), n("<p>(<li.+?)</p>", "$1"), n("<p>\\s*(</?" + r + "[^>]*>)", "$1"), n("(</?" + r + "[^>]*>)\\s*</p>", "$1"), n("(</?" + r + "[^>]*>)\\s*<br />", "$1"), n("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)", "$1"), e.indexOf("<pre") != -1 && n("(<pre(.|\n)*?>)((.|\n)*?)</pre>", function (e, n, r, i) {
        return t(n, "\\\\(['\"\\\\])", "$1") + t(t(t(i, "<p>", "\n"), "</p>|<br />", ""), "\\\\(['\"\\\\])", "$1") + "</pre>"
    }), n("\n</p>$", "</p>")
}, stripTags: function (e) {
    var t = this.opts.allowedTags, n = /<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;
    return e.replace(n, function (e, n) {
        return $.inArray(n.toLowerCase(), t) > "-1" ? e : ""
    })
}, pasteCleanUp: function (e) {
    e = e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi, ""), e = e.replace(/(&nbsp;){1,}/gi, "&nbsp;"), e = e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi, "$2"), e = this.stripTags(e), e = e.replace(/<td><br><\/td>/gi, "[td]"), e = e.replace(/<a(.*?)>([\w\W]*?)<\/a>/gi, "[a$1]$2[/a]"), e = e.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi, "[iframe$1]$2[/iframe]"), e = e.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi, "[video$1]$2[/video]"), e = e.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi, "[audio$1]$2[/audio]"), e = e.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi, "[object$1]$2[/object]"), e = e.replace(/<img(.*?)>/gi, "[img$1]"), e = e.replace(/<(\w+)([\w\W]*?)>/gi, "<$1>"), e = e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi, ""), e = e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi, ""), e = e.replace(/\[td\]/gi, "<td><br></td>"), e = e.replace(/\[a(.*?)\]([\w\W]*?)\[\/a\]/gi, "<a$1>$2</a>"), e = e.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi, "<iframe$1>$2</iframe>"), e = e.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi, "<video$1>$2[/video>"), e = e.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi, "<audio$1>$2[/audio>"), e = e.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi, "<object$1>$2</object>"), e = e.replace(/\[img(.*?)\]/gi, "<img$1>"), e = e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi, "<p>$2</p>"), e = e.replace(/<span>([\w\W]*?)<\/span>/gi, "$1"), e = e.replace(/\n{3,}/gi, "\n"), e = e.replace(/<p><p>/g, "<p>"), e = e.replace(/<\/p><\/p>/g, "</p>"), this.execCommand("inserthtml", e)
}, formattingRemove: function (e) {
    var t = [], n = e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);
    return n !== null && $.each(n, function (n, r) {
        e = e.replace(r, "prebuffer_" + n), t.push(r)
    }), e = e.replace(/\s{2,}/g, " "), e = e.replace(/\n/g, " "), e = e.replace(/[\t]*/g, ""), e = e.replace(/\n\s*\n/g, "\n"), e = e.replace(/^[\s\n]*/g, ""), e = e.replace(/[\s\n]*$/g, ""), e = e.replace(/>\s+</g, "><"), t && ($.each(t, function (t, n) {
        e = e.replace("prebuffer_" + t, n)
    }), t = []), e
}, formattingIndenting: function (e) {
    return e = e.replace(/<li/g, "	<li"), e = e.replace(/<tr/g, "	<tr"), e = e.replace(/<td/g, "		<td"), e = e.replace(/<\/tr>/g, "	</tr>"), e
}, formattingEmptyTags: function (e) {
    var t = ["<pre></pre>", "<blockquote>\\s*</blockquote>", "<em>\\s*</em>", "<ul></ul>", "<ol></ol>", "<li></li>", "<table></table>", "<tr></tr>", "<span>\\s*<span>", "<span>&nbsp;<span>", "<b>\\s*</b>", "<b>&nbsp;</b>", "<p>\\s*</p>", "<p>&nbsp;</p>", "<p>\\s*<br>\\s*</p>", "<div>\\s*</div>", "<div>\\s*<br>\\s*</div>"];
    for (var n = 0; n < t.length; ++n) {
        var r = t[n];
        e = e.replace(new RegExp(r, "gi"), "")
    }
    return e
}, formattingAddBefore: function (e) {
    var t = "\r\n", n = ["<p", "<form", "</ul>", "</ol>", "<fieldset", "<legend", "<object", "<embed", "<select", "<option", "<input", "<textarea", "<pre", "<blockquote", "<ul", "<ol", "<li", "<dl", "<dt", "<dd", "<table", "<thead", "<tbody", "<caption", "</caption>", "<th", "<tr", "<td", "<figure"];
    for (var r = 0; r < n.length; ++r) {
        var i = n[r];
        e = e.replace(new RegExp(i, "gi"), t + i)
    }
    return e
}, formattingAddAfter: function (e) {
    var t = "\r\n", n = ["</p>", "</div>", "</h1>", "</h2>", "</h3>", "</h4>", "</h5>", "</h6>", "<br>", "<br />", "</dl>", "</dt>", "</dd>", "</form>", "</blockquote>", "</pre>", "</legend>", "</fieldset>", "</object>", "</embed>", "</textarea>", "</select>", "</option>", "</table>", "</thead>", "</tbody>", "</tr>", "</td>", "</th>", "</figure>"];
    for (var r = 0; r < n.length; ++r) {
        var i = n[r];
        e = e.replace(new RegExp(i, "gi"), i + t)
    }
    return e
}, formatting: function (e) {
    return e = this.formattingRemove(e), e = this.formattingEmptyTags(e), e = this.formattingAddBefore(e), e = this.formattingAddAfter(e), e = this.formattingIndenting(e), e
}, toggle: function () {
    var e;
    this.opts.visual ? (this.$editor.hide(), e = this.$editor.html(), e = $.trim(this.formatting(e)), this.$el.val(e).show().focus(), this.setBtnActive("html"), this.opts.visual = !1) : (this.$el.hide(), this.$editor.html(this.$el.val()), this.$editor.show(), this.$editor.html() === "" && ($.browser.mozilla ? e = this.opts.mozillaEmptyHtml : e = this.opts.allEmptyHtml, this.setCode(e)), this.$editor.focus(), this.setBtnInactive("html"), this.opts.visual = !0, this.observeImages(), this.observeTables())
}, autoSave: function () {
    setInterval($.proxy(function () {
        $.post(this.opts.autosave, {data: this.getCode()})
    }, this), this.opts.interval * 1e3)
}, buildToolbar: function () {
    if (this.opts.toolbar === !1)return!1;
    this.$toolbar = $("<ul>").addClass("redactor_toolbar"), this.opts.air ? ($(this.air).append(this.$toolbar), $("body").prepend(this.air)) : this.$box.prepend(this.$toolbar), $.each(this.opts.buttons, $.proxy(function (e, t) {
        if (t !== "|" && typeof this.opts.toolbar[t] != "undefined") {
            var n = this.opts.toolbar[t];
            if (this.opts.fileUpload === !1 && t === "file")return!0;
            var r = $("<li>"), i = this.buildButton(t, n);
            if (t === "backcolor" || t === "fontcolor" || typeof n.dropdown != "undefined") {
                var s = $('<div class="redactor_dropdown" style="display: none;">');
                t === "backcolor" || t === "fontcolor" ? s = this.buildColorPicker(s, t) : s = this.buildDropdown(s, n.dropdown), this.dropdowns.push(s.appendTo($(document.body))), this.hdlHideDropDown = $.proxy(function (e) {
                    this.hideDropDown(e, s, t)
                }, this), this.hdlShowDropDown = $.proxy(function (e) {
                    this.showDropDown(e, s, t)
                }, this), i.click(this.hdlShowDropDown)
            }
            this.$toolbar.append($(r).append(i))
        }
        t === "|" && this.$toolbar.append($('<li class="redactor_separator"></li>'))
    }, this)), $(document).click(this.hdlHideDropDown), this.$editor.click(this.hdlHideDropDown)
}, buildButton: function (e, t) {
    var n = $('<a href="javascript:void(null);" title="' + t.title + '" class="redactor_btn_' + e + '"></a>');
    return typeof t.func == "undefined" ? n.click($.proxy(function () {
        this.execCommand(t.exec, e)
    }, this)) : t.func !== "show" && n.click($.proxy(function (e) {
        this.oldIE() && (this.$editor.focus(), this.saveSelection()), this[t.func](e)
    }, this)), typeof t.callback != "undefined" && n.click($.proxy(function (n) {
        t.callback(this, n, e)
    }, this)), n
}, buildDropdown: function (e, t) {
    return $.each(t, $.proxy(function (t, n) {
        typeof n.className == "undefined" && (n.className = "");
        var r;
        typeof n.name != "undefined" && n.name === "separator" ? r = $('<a class="redactor_separator_drop">') : (r = $('<a href="javascript:void(null);" class="' + n.className + '">' + n.title + "</a>"), typeof n.func == "undefined" ? $(r).click($.proxy(function () {
            this.execCommand(n.exec, t)
        }, this)) : $(r).click($.proxy(function (e) {
            this[n.func](e)
        }, this))), $(e).append(r)
    }, this)), e
}, buildColorPicker: function (e, t) {
    var n;
    t === "backcolor" ? $.browser.msie ? n = "BackColor" : n = "hilitecolor" : n = "forecolor", $(e).width(210);
    var r = this.opts.colors.length;
    for (var i = 0; i < r; ++i) {
        var s = this.opts.colors[i], o = $('<a rel="' + s + '" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor: s});
        $(e).append(o);
        var u = this;
        $(o).click(function () {
            u.execCommand(n, $(this).attr("rel")), n === "forecolor" && u.$editor.find("font").replaceWith(function () {
                return $('<span style="color: ' + $(this).attr("color") + ';">' + $(this).html() + "</span>")
            }), $.browser.msie && n === "BackColor" && u.$editor.find("font").replaceWith(function () {
                return $('<span style="' + $(this).attr("style") + '">' + $(this).html() + "</span>")
            })
        })
    }
    var a = $('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);
    return t === "backcolor" ? a.click($.proxy(this.setBackgroundNone, this)) : a.click($.proxy(this.setColorNone, this)), $(e).append(a), e
}, setBackgroundNone: function () {
    $(this.getParentNode()).css("background-color", "transparent"), this.syncCode()
}, setColorNone: function () {
    $(this.getParentNode()).attr("color", "").css("color", ""), this.syncCode()
}, showDropDown: function (e, t, n) {
    if (this.getBtn(n).hasClass("dropact"))this.hideAllDropDown(); else {
        this.hideAllDropDown(), this.setBtnActive(n), this.getBtn(n).addClass("dropact");
        var r = this.getBtn(n).offset().left;
        if (this.opts.air) {
            var i = this.air.offset().top;
            $(t).css({position: "absolute", left: r + "px", top: i + 30 + "px"}).show()
        } else if (this.opts.fixed && this.fixed)$(t).css({position: "fixed", left: r + "px", top: "30px"}).show(); else {
            var s = this.$toolbar.offset().top + 30;
            $(t).css({position: "absolute", left: r + "px", top: s + "px"}).show()
        }
    }
}, hideAllDropDown: function () {
    this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact"), $(".redactor_dropdown").hide()
}, hideDropDown: function (e, t, n) {
    $(e.target).hasClass("dropact") || ($(t).removeClass("act"), this.showedDropDown = !1, this.hideAllDropDown())
}, getSelection: function () {
    if (typeof window.getSelection != "undefined")return document.getSelection();
    if (typeof document.selection != "undefined")return document.selection.createRange()
}, getFragmentHtml: function (e) {
    var t = e.cloneNode(!0), n = document.createElement("div");
    return n.appendChild(t), n.innerHTML
}, extractContent: function () {
    var e = this.$editor.get(0), t = document.createDocumentFragment(), n;
    while (n = e.firstChild)t.appendChild(n);
    return t
}, saveSelection: function () {
    this.savedSel = null, this.savedSelObj = null;
    if ($.browser.msie && parseInt($.browser.version, 10) < 9) {
        var e = this.$editor.get(0);
        this.savedSel = window.Selection.getOrigin(e), this.savedSelObj = window.Selection.getFocus(e)
    } else this.savedSel = window.Selection.getOrigin(window), this.savedSelObj = window.Selection.getFocus(window)
}, restoreSelection: function () {
    this.savedSel !== null && this.savedSelObj !== null && this.savedSel[0].tagName !== "BODY" ? window.Selection.setSelection(window, this.savedSel[0], this.savedSel[1], this.savedSelObj[0], this.savedSelObj[1]) : this.$editor.focus()
}, getParentNode: function () {
    if (typeof window.getSelection != "undefined") {
        var e = window.getSelection();
        return e.rangeCount > 0 ? this.getSelection().getRangeAt(0).startContainer.parentNode : !1
    }
    if (typeof document.selection != "undefined")return this.getSelection().parentElement()
}, getCurrentNode: function () {
    if (typeof window.getSelection != "undefined")return this.getSelection().getRangeAt(0).startContainer;
    if (typeof document.selection != "undefined")return this.getSelection()
}, setFocusNode: function (e) {
    if (typeof e == "undefined")return!1;
    try {
        var t = document.createRange(), n = this.getSelection();
        n !== null && (t.selectNodeContents(e), n.addRange(t), n.collapse(e, 0)), this.$editor.focus()
    } catch (r) {
    }
}, insertNodeAtCaret: function (e) {
    if (window.getSelection) {
        var t = this.getSelection();
        if (t.rangeCount) {
            var n = t.getRangeAt(0);
            n.collapse(!1), n.insertNode(e), n = n.cloneRange(), n.selectNodeContents(e), n.collapse(!1), t.removeAllRanges(), t.addRange(n)
        }
    } else if (document.selection) {
        var r = e.nodeType === 1 ? e.outerHTML : e.data, i = "marker_" + ("" + Math.random()).slice(2);
        r += '<span id="' + i + '"></span>';
        var s = this.getSelection();
        s.collapse(!1), s.pasteHTML(r);
        var o = document.getElementById(i);
        s.moveToElementText(o), s.select(), o.parentNode.removeChild(o)
    }
}, getSelectedHtml: function () {
    var e = "";
    if (window.getSelection) {
        var t = window.getSelection();
        if (t.rangeCount) {
            var n = document.createElement("div");
            for (var r = 0, i = t.rangeCount; r < i; ++r)n.appendChild(t.getRangeAt(r).cloneContents());
            e = n.innerHTML
        }
    } else document.selection && document.selection.type === "Text" && (e = document.selection.createRange().htmlText);
    return e
}, getBtn: function (e) {
    return $(this.$toolbar.find("a.redactor_btn_" + e))
}, setBtnActive: function (e) {
    this.getBtn(e).addClass("act")
}, setBtnInactive: function (e) {
    this.getBtn(e).removeClass("act")
}, resizeImage: function (e) {
    var t = !1, n = !1, r, i, s = $(e).width() / $(e).height(), o = 10, u = 10;
    $(e).hover(function () {
        $(e).css("cursor", "nw-resize")
    }, function () {
        $(e).css("cursor", "default"), t = !1
    }), $(e).mousedown(function (s) {
        s.preventDefault(), t = !0, n = !0, r = Math.round(s.pageX - $(e).eq(0).offset().left), i = Math.round(s.pageY - $(e).eq(0).offset().top)
    }), $(e).mouseup($.proxy(function (e) {
        t = !1, this.syncCode()
    }, this)), $(e).click($.proxy(function (e) {
        n && this.imageEdit(e)
    }, this)), $(e).mousemove(function (a) {
        if (t) {
            n = !1;
            var f = Math.round(a.pageX - $(this).eq(0).offset().left) - r, l = Math.round(a.pageY - $(this).eq(0).offset().top) - i, c = $(e).height(), h = parseInt(c, 10) + l, p = h * s;
            p > o && $(e).width(p), h > u && $(e).height(h), r = Math.round(a.pageX - $(this).eq(0).offset().left), i = Math.round(a.pageY - $(this).eq(0).offset().top)
        }
    })
}, showTable: function () {
    this.saveSelection(), this.modalInit(RLANG.table, "table", 300, $.proxy(function () {
        $("#redactor_insert_table_btn").click($.proxy(this.insertTable, this))
    }, this), function () {
        $("#redactor_table_rows").focus()
    })
}, insertTable: function () {
    var e = $("#redactor_table_rows").val(), t = $("#redactor_table_columns").val(), n = $("<div></div>"), r = Math.floor(Math.random() * 99999), i = $('<table id="table' + r + '"><tbody></tbody></table>');
    for (var s = 0; s < e; s++) {
        var o = $("<tr></tr>");
        for (var u = 0; u < t; u++) {
            var a = $("<td><br></td>");
            $(o).append(a)
        }
        $(i).append(o)
    }
    $(n).append(i);
    var f = $(n).html() + "<p></p>";
    this.restoreSelection(), this.execCommand("inserthtml", f), this.modalClose(), this.observeTables()
}, tableObserver: function (e) {
    this.$table = $(e.target).parents("table"), this.$table_tr = this.$table.find("tr"), this.$table_td = this.$table.find("td"), this.$table_td.removeClass("current"), this.$tbody = $(e.target).parents("tbody"), this.$thead = $(this.$table).find("thead"), this.$current_td = $(e.target), this.$current_td.addClass("current"), this.$current_tr = $(e.target).parents("tr")
}, deleteTable: function () {
    $(this.$table).remove(), this.$table = !1, this.syncCode()
}, deleteRow: function () {
    $(this.$current_tr).remove(), this.syncCode()
}, deleteColumn: function () {
    var e = $(this.$current_td).get(0).cellIndex;
    $(this.$table).find("tr").each(function () {
        $(this).find("td").eq(e).remove()
    }), this.syncCode()
}, addHead: function () {
    if ($(this.$table).find("thead").size() !== 0)this.deleteHead(); else {
        var e = $(this.$table).find("tr").first().clone();
        e.find("td").html("&nbsp;"), this.$thead = $("<thead></thead>"), this.$thead.append(e), $(this.$table).prepend(this.$thead), this.syncCode()
    }
}, deleteHead: function () {
    $(this.$thead).remove(), this.$thead = !1, this.syncCode()
}, insertRowAbove: function () {
    this.insertRow("before")
}, insertRowBelow: function () {
    this.insertRow("after")
}, insertColumnLeft: function () {
    this.insertColumn("before")
}, insertColumnRight: function () {
    this.insertColumn("after")
}, insertRow: function (e) {
    var t = $(this.$current_tr).clone();
    t.find("td").html("&nbsp;"), e === "after" ? $(this.$current_tr).after(t) : $(this.$current_tr).before(t), this.syncCode()
}, insertColumn: function (e) {
    var t = 0;
    this.$current_td.addClass("current"), this.$current_tr.find("td").each(function (e, n) {
        $(n).hasClass("current") && (t = e)
    }), this.$table_tr.each(function (n, r) {
        var i = $(r).find("td").eq(t), s = i.clone();
        s.html("&nbsp;"), e === "after" ? $(i).after(s) : $(i).before(s)
    }), this.syncCode()
}, showVideo: function () {
    this.saveSelection(), this.modalInit(RLANG.video, "video", 600, $.proxy(function () {
        $("#redactor_insert_video_btn").click($.proxy(this.insertVideo, this))
    }, this), function () {
        $("#redactor_insert_video_area").focus()
    })
}, insertVideo: function () {
    var e = $("#redactor_insert_video_area").val();
    e = this.stripTags(e), this.restoreSelection(), this.execCommand("inserthtml", e), this.modalClose()
}, imageEdit: function (e) {
    var t = $(e.target), n = t.parent(), r = $.proxy(function () {
        $("#redactor_file_alt").val(t.attr("alt")), $("#redactor_image_edit_src").attr("href", t.attr("src")), $("#redactor_form_image_align").val(t.css("float")), $(n).get(0).tagName === "A" && $("#redactor_file_link").val($(n).attr("href")), $("#redactor_image_delete_btn").click($.proxy(function () {
            this.imageDelete(t)
        }, this)), $("#redactorSaveBtn").click($.proxy(function () {
            this.imageSave(t)
        }, this))
    }, this);
    this.modalInit(RLANG.image, "image_edit", 380, r)
}, imageDelete: function (e) {
    $(e).remove(), this.modalClose(), this.syncCode()
}, imageSave: function (e) {
    var t = $(e).parent();
    $(e).attr("alt", $("#redactor_file_alt").val());
    var n = $("#redactor_form_image_align").val();
    n === "left" ? $(e).css({"float": "left", margin: "0 10px 10px 0"}) : n === "right" ? $(e).css({"float": "right", margin: "0 0 10px 10px"}) : $(e).css({"float": "none", margin: "0"});
    var r = $.trim($("#redactor_file_link").val());
    r !== "" ? $(t).get(0).tagName !== "A" ? $(e).replaceWith('<a href="' + r + '">' + this.outerHTML(e) + "</a>") : $(t).attr("href", r) : $(t).get(0).tagName === "A" && $(t).replaceWith(this.outerHTML(e)), this.modalClose(), this.observeImages(), this.syncCode()
}, showImage: function () {
    this.saveSelection();
    var e = $.proxy(function () {
        this.opts.imageGetJson !== !1 ? $.getJSON(this.opts.imageGetJson, $.proxy(function (e) {
            $.each(e, $.proxy(function (e, t) {
                var n = $('<img src="' + t.thumb + '" rel="' + t.image + '" />');
                $("#redactor_image_box").append(n), $(n).click($.proxy(this.imageSetThumb, this))
            }, this))
        }, this)) : $("#redactor_tabs a").eq(1).remove();
        if (this.opts.imageUpload !== !1)this.opts.uploadCrossDomain === !1 && this.isMobile() === !1 && $("#redactor_file").size() !== 0 && $("#redactor_file").dragupload({url: this.opts.imageUpload, uploadFields: this.opts.uploadFields, success: $.proxy(this.imageUploadCallback, this)}), this.uploadInit("redactor_file", {auto: !0, url: this.opts.imageUpload, success: $.proxy(this.imageUploadCallback, this)}); else {
            $(".redactor_tab").hide();
            if (this.opts.imageGetJson === !1)$("#redactor_tabs").remove(), $("#redactor_tab3").show(); else {
                var e = $("#redactor_tabs a");
                e.eq(0).remove(), e.eq(1).addClass("redactor_tabs_act"), $("#redactor_tab2").show()
            }
        }
        $("#redactor_upload_btn").click($.proxy(this.imageUploadCallbackLink, this))
    }, this), t = $.proxy(function () {
        this.opts.imageUpload === !1 && this.opts.imageGetJson === !1 && $("#redactor_file_link").focus()
    }, this);
    this.modalInit(RLANG.image, "image", 570, e, t, !0)
}, imageSetThumb: function (e) {
    this._imageSet('<img alt="" src="' + $(e.target).attr("rel") + '" />', !0)
}, imageUploadCallbackLink: function () {
    if ($("#redactor_file_link").val() !== "") {
        var e = '<img src="' + $("#redactor_file_link").val() + '" />';
        this._imageSet(e, !0)
    } else this.modalClose()
}, imageUploadCallback: function (e) {
    this._imageSet(e)
}, _imageSet: function (e, t) {
    this.restoreSelection();
    if (e !== !1) {
        var n = "", r = "";
        t !== !0 ? (r = $.parseJSON(e), n = '<p><img src="' + r.filelink + '" /></p>') : n = e, this.execCommand("inserthtml", n), t !== !0 && typeof this.opts.imageUploadCallback == "function" && this.opts.imageUploadCallback(this, r)
    }
    this.modalClose(), this.observeImages()
}, showLink: function () {
    this.saveSelection();
    var e = $.proxy(function () {
        var e = this.getSelection(), t = "", n = "";
        if ($.browser.msie) {
            var r = this.getParentNode();
            if (r.nodeName === "A")this.insert_link_node = $(r), n = this.insert_link_node.text(), t = this.insert_link_node.attr("href"); else {
                this.oldIE() ? n = e.text : n = e.toString(), this.spanid = Math.floor(Math.random() * 99999);
                var i = '<span id="span' + this.spanid + '">' + n + "</span>";
                n !== "" && (i = '<span id="span' + this.spanid + '">' + n + "</span>"), this.execCommand("inserthtml", i)
            }
        } else e && e.anchorNode && e.anchorNode.parentNode.tagName === "A" ? (t = e.anchorNode.parentNode.href, n = e.anchorNode.parentNode.text, e.toString() === "" && (this.insert_link_node = e.anchorNode.parentNode)) : (n = e.toString(), t = "");
        $(".redactor_link_text").val(n);
        var s = t.replace(top.location.href, "");
        t.search("mailto:") === 0 ? (this.setModalTab(2), $("#redactor_tab_selected").val(2), $("#redactor_link_mailto").val(t.replace("mailto:", ""))) : s.search(/^#/gi) === 0 ? (this.setModalTab(3), $("#redactor_tab_selected").val(3), $("#redactor_link_anchor").val(s.replace(/^#/gi, ""))) : $("#redactor_link_url").val(t), $("#redactor_insert_link_btn").click($.proxy(this.insertLink, this))
    }, this), t = function (e) {
        $("#redactor_link_url").focus()
    };
    this.modalInit(RLANG.link, "link", 460, e, t)
}, insertLink: function () {
    var e = $("#redactor_tab_selected").val(), t = "", n = "";
    e === "1" ? (t = $("#redactor_link_url").val(), n = $("#redactor_link_url_text").val()) : e === "2" ? (t = "mailto:" + $("#redactor_link_mailto").val(), n = $("#redactor_link_mailto_text").val()) : e === "3" && (t = "#" + $("#redactor_link_anchor").val(), n = $("#redactor_link_anchor_text").val()), this._insertLink('<a href="' + t + '">' + n + "</a> ", $.trim(n), t)
}, _insertLink: function (e, t, n) {
    this.restoreSelection(), t !== "" && (this.insert_link_node ? ($(this.insert_link_node).text(t), $(this.insert_link_node).attr("href", n), this.syncCode()) : $.browser.msie ? ($("#span" + this.spanid).replaceWith(e), this.syncCode()) : this.execCommand("inserthtml", e)), this.modalClose()
}, showFile: function () {
    this.saveSelection();
    var e = $.proxy(function () {
        var e = this.getSelection(), t = "";
        this.oldIE() ? t = e.text : t = e.toString(), $("#redactor_filename").val(t), this.opts.uploadCrossDomain === !1 && this.isMobile() === !1 && $("#redactor_file").dragupload({url: this.opts.fileUpload, uploadFields: this.opts.uploadFields, success: $.proxy(function (e) {
            this.fileUploadCallback(e)
        }, this)}), this.uploadInit("redactor_file", {auto: !0, url: this.opts.fileUpload, success: $.proxy(function (e) {
            this.fileUploadCallback(e)
        }, this)})
    }, this);
    this.modalInit(RLANG.file, "file", 500, e)
}, fileUploadCallback: function (e) {
    this.restoreSelection();
    if (e !== !1) {
        var t = $.parseJSON(e), n = $("#redactor_filename").val();
        n === "" && (n = t.filename);
        var r = '<a href="' + t.filelink + '">' + n + "</a>";
        $.browser.webkit && !!window.chrome && (r += "&nbsp;"), this.execCommand("inserthtml", r), typeof this.opts.fileUploadCallback == "function" && this.opts.fileUploadCallback(this, t)
    }
    this.modalClose()
}, modalInit: function (e, t, n, r, i, s) {
    $("#redactor_modal_overlay").size() === 0 && (this.overlay = $('<div id="redactor_modal_overlay" style="display: none;"></div>'), $("body").prepend(this.overlay)), this.opts.overlay && ($("#redactor_modal_overlay").show(), $("#redactor_modal_overlay").click($.proxy(this.modalClose, this))), $("#redactor_modal").size() === 0 && (this.modal = $('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'), $("body").append(this.modal)), $("#redactor_modal_close").click($.proxy(this.modalClose, this)), this.hdlModalClose = $.proxy(function (e) {
        e.keyCode === 27 && this.modalClose()
    }, this), $(document).keyup(this.hdlModalClose), this.$editor.keyup(this.hdlModalClose), $("#redactor_modal_inner").html(this.opts["modal_" + t]), $("#redactor_modal_header").html(e);
    if ($("#redactor_tabs").size() !== 0) {
        var o = this;
        $("#redactor_tabs a").each(function (e, t) {
            e++, $(t).click(function () {
                $("#redactor_tabs a").removeClass("redactor_tabs_act"), $(this).addClass("redactor_tabs_act"), $(".redactor_tab").hide(), $("#redactor_tab" + e).show(), $("#redactor_tab_selected").val(e);
                if (o.isMobile() === !1) {
                    var t = $("#redactor_modal").outerHeight();
                    $("#redactor_modal").css("margin-top", "-" + (t + 10) / 2 + "px")
                }
            })
        })
    }
    $("#redactor_btn_modal_close").click($.proxy(this.modalClose, this)), typeof r == "function" && r();
    var u = $("#redactor_modal").outerHeight();
    this.isMobile() === !1 ? $("#redactor_modal").css({position: "fixed", top: "50%", left: "50%", width: n + "px", height: "auto", minHeight: "auto", marginTop: "-" + (u + 10) / 2 + "px", marginLeft: "-" + (n + 60) / 2 + "px"}).fadeIn("fast") : $("#redactor_modal").css({position: "fixed", width: "100%", height: "100%", top: "0", left: "0", margin: "0", minHeight: "300px"}).show(), typeof i == "function" && i(), s === !0 && $("#redactor_image_box").height(300).css("overflow", "auto")
}, modalClose: function () {
    $("#redactor_modal_close").unbind("click", this.modalClose), $("#redactor_modal").fadeOut("fast", $.proxy(function () {
        $("#redactor_modal_inner").html(""), this.opts.overlay && ($("#redactor_modal_overlay").hide(), $("#redactor_modal_overlay").unbind("click", this.modalClose)), $(document).unbind("keyup", this.hdlModalClose), this.$editor.unbind("keyup", this.hdlModalClose)
    }, this))
}, setModalTab: function (e) {
    $(".redactor_tab").hide();
    var t = $("#redactor_tabs a");
    t.removeClass("redactor_tabs_act"), t.eq(e - 1).addClass("redactor_tabs_act"), $("#redactor_tab" + e).show()
}, uploadInit: function (e, t) {
    this.uploadOptions = {url: !1, success: !1, start: !1, trigger: !1, auto: !1, input: !1}, $.extend(this.uploadOptions, t), $("#" + e).size() !== 0 && $("#" + e).get(0).tagName === "INPUT" ? (this.uploadOptions.input = $("#" + e), this.element = $($("#" + e).get(0).form)) : this.element = $("#" + e), this.element_action = this.element.attr("action"), this.uploadOptions.auto ? $(this.uploadOptions.input).change($.proxy(function () {
        this.element.submit(function (e) {
            return!1
        }), this.uploadSubmit()
    }, this)) : this.uploadOptions.trigger && $("#" + this.uploadOptions.trigger).click($.proxy(this.uploadSubmit, this))
}, uploadSubmit: function () {
    this.uploadForm(this.element, this.uploadFrame())
}, uploadFrame: function () {
    this.id = "f" + Math.floor(Math.random() * 99999);
    var e = document.createElement("div"), t = '<iframe style="display:none" id="' + this.id + '" name="' + this.id + '"></iframe>';
    return e.innerHTML = t, document.body.appendChild(e), this.uploadOptions.start && this.uploadOptions.start(), $("#" + this.id).load($.proxy(this.uploadLoaded, this)), this.id
}, uploadForm: function (e, t) {
    if (this.uploadOptions.input) {
        var n = "redactorUploadForm" + this.id, r = "redactorUploadFile" + this.id;
        this.form = $('<form  action="' + this.uploadOptions.url + '" method="POST" target="' + t + '" name="' + n + '" id="' + n + '" enctype="multipart/form-data"></form>'), this.opts.uploadFields !== !1 && typeof this.opts.uploadFields == "object" && $.each(this.opts.uploadFields, $.proxy(function (e, t) {
            t.indexOf("#") === 0 && (t = $(t).val());
            var n = $('<input type="hidden" name="' + e + '" value="' + t + '">');
            $(this.form).append(n)
        }, this));
        var i = this.uploadOptions.input, s = $(i).clone();
        $(i).attr("id", r), $(i).before(s), $(i).appendTo(this.form), $(this.form).css("position", "absolute"), $(this.form).css("top", "-2000px"), $(this.form).css("left", "-2000px"), $(this.form).appendTo("body"), this.form.submit()
    } else e.attr("target", t), e.attr("method", "POST"), e.attr("enctype", "multipart/form-data"), e.attr("action", this.uploadOptions.url), this.element.submit()
}, uploadLoaded: function () {
    var e = $("#" + this.id), t;
    e.contentDocument ? t = e.contentDocument : e.contentWindow ? t = e.contentWindow.document : t = window.frames[this.id].document;
    if (this.uploadOptions.success)if (typeof t != "undefined") {
        var n = t.body.innerHTML, r = n.match(/\{.*\}/)[0];
        this.uploadOptions.success(r)
    } else alert("Upload failed!"), this.uploadOptions.success(!1);
    this.element.attr("action", this.element_action), this.element.attr("target", "")
}, oldIE: function () {
    return $.browser.msie && parseInt($.browser.version, 10) < 9 ? !0 : !1
}, outerHTML: function (e) {
    return $("<p>").append($(e).eq(0).clone()).html()
}, normalize: function (e) {
    return parseInt(e.replace("px", ""), 10)
}, isMobile: function (e) {
    return e === !0 && /(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent) ? !0 : /(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent) ? !0 : !1
}}, $.fn.getEditor = function () {
    return this.data("redactor").$editor
}, $.fn.getCode = function () {
    return this.data("redactor").getCode()
}, $.fn.getText = function () {
    return this.data("redactor").$editor.text()
}, $.fn.getSelected = function () {
    return this.data("redactor").getSelectedHtml()
}, $.fn.setCode = function (e) {
    this.data("redactor").setCode(e)
}, $.fn.insertHtml = function (e) {
    this.data("redactor").insertHtml(e)
}, $.fn.destroyEditor = function () {
    this.data("redactor").destroy(), this.removeData("redactor")
}, $.fn.setFocus = function () {
    this.data("redactor").focus()
}, $.fn.execCommand = function (e, t) {
    this.data("redactor").execCommand(e, t)
}, function (e) {
    function t(t, n) {
        this.opts = e.extend({url: !1, success: !1, preview: !1, uploadFields: !1, text: RLANG.drop_file_here, atext: RLANG.or_choose}, n), this.$el = e(t)
    }

    e.fn.dragupload = function (e) {
        return this.each(function () {
            var n = new t(this, e);
            n.init()
        })
    }, t.prototype = {init: function () {
        if (!e.browser.msie) {
            this.droparea = e('<div class="redactor_droparea"></div>'), this.dropareabox = e('<div class="redactor_dropareabox">' + this.opts.text + "</div>"), this.dropalternative = e('<div class="redactor_dropalternative">' + this.opts.atext + "</div>"), this.droparea.append(this.dropareabox), this.$el.before(this.droparea), this.$el.before(this.dropalternative), this.dropareabox.bind("dragover", e.proxy(function () {
                return this.ondrag()
            }, this)), this.dropareabox.bind("dragleave", e.proxy(function () {
                return this.ondragleave()
            }, this));
            var t = e.proxy(function (e) {
                var t = parseInt(e.loaded / e.total * 100, 10);
                this.dropareabox.text("Loading " + t + "%")
            }, this), n = jQuery.ajaxSettings.xhr();
            n.upload && n.upload.addEventListener("progress", t, !1);
            var r = function () {
                return n
            };
            this.dropareabox.get(0).ondrop = e.proxy(function (t) {
                t.preventDefault(), this.dropareabox.removeClass("hover").addClass("drop");
                var n = t.dataTransfer.files[0], i = new FormData;
                this.opts.uploadFields !== !1 && typeof this.opts.uploadFields == "object" && e.each(this.opts.uploadFields, e.proxy(function (t, n) {
                    n.indexOf("#") === 0 && (n = e(n).val()), i.append(t, n)
                }, this)), i.append("file", n), e.ajax({dataType: "html", url: this.opts.url, data: i, xhr: r, cache: !1, contentType: !1, processData: !1, type: "POST", success: e.proxy(function (e) {
                    this.opts.success !== !1 && this.opts.success(e), this.opts.preview === !0 && this.dropareabox.html(e)
                }, this)})
            }, this)
        }
    }, ondrag: function () {
        return this.dropareabox.addClass("hover"), !1
    }, ondragleave: function () {
        return this.dropareabox.removeClass("hover"), !1
    }}
}(jQuery), function (e) {
    var t = /(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g, n = /(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g, r = function () {
        var i = this.childNodes, s = i.length;
        while (s--) {
            var o = i[s];
            if (o.nodeType === 3) {
                var u = o.nodeValue;
                u && (u = u.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(t, '$1<a href="http://$2">$2</a>$3').replace(n, '$1<a href="$2">$2</a>$5'), e(o).after(u).remove())
            } else o.nodeType === 1 && !/^(a|button|textarea)$/i.test(o.tagName) && r.call(o)
        }
    };
    e.fn.linkify = function () {
        this.each(r)
    }
}(jQuery), function (e) {
    e.event.special.textselect = {setup: function (t, n) {
        e(this).data("textselected", !1), e(this).data("ttt", t), e(this).bind("mouseup", e.event.special.textselect.handler)
    }, teardown: function (t) {
        e(this).unbind("mouseup", e.event.special.textselect.handler)
    }, handler: function (t) {
        var n = e(this).data("ttt"), r = e.event.special.textselect.getSelectedText(n).toString();
        r != "" && (e(this).data("textselected", !0), t.type = "textselect", t.text = r, e.event.handle.apply(this, arguments))
    }, getSelectedText: function (e) {
        var t = "";
        return window.getSelection ? t = window.getSelection() : document.getSelection ? t = document.getSelection() : document.selection && (t = document.selection.createRange().text), t
    }}, e.event.special.textunselect = {setup: function (t, n) {
        e(this).data("rttt", t), e(this).data("textselected", !1), e(this).bind("mouseup", e.event.special.textunselect.handler), e(this).bind("keyup", e.event.special.textunselect.handlerKey)
    }, teardown: function (t) {
        e(this).unbind("mouseup", e.event.special.textunselect.handler)
    }, handler: function (t) {
        if (e(this).data("textselected")) {
            var n = e(this).data("rttt"), r = e.event.special.textselect.getSelectedText(n).toString();
            r == "" && (e(this).data("textselected", !1), t.type = "textunselect", e.event.handle.apply(this, arguments))
        }
    }, handlerKey: function (t) {
        if (e(this).data("textselected")) {
            var n = e(this).data("rttt"), r = e.event.special.textselect.getSelectedText(n).toString();
            (t.keyCode = 27) && r == "" && (e(this).data("textselected", !1), t.type = "textunselect", e.event.handle.apply(this, arguments))
        }
    }}
}(jQuery), define("redactor", function () {
});